<!DOCTYPE html>
<html lang=en>
  <head>
  <meta http-equiv=X-UA-Compatible content="IE=edge">
  <meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>In-Depth Nginx</title>

  <meta name=author content="Mark Robinson" />

  

  <link rel="shortcut icon" type="image/x-icon" href="https://robinm8.github.io/favicon.ico">

  <link rel=alternate type="application/rss+xml" title="Mark Robinson - My life into the enjoining future" href="/feed.xml" />

  <!-- Facebook OpenGraph tags -->
  <meta property="og:title" content="In-Depth Nginx" />
  <meta property=og:type content="website" />

  
  <meta property=og:url content="https://robinm8.github.io/2016-12-05-In-Depth_Nginx/" />
  

  
  <meta property=og:image content="https://robinm8.github.io/img/close_up.png" />
  

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class=container-fluid>
    <div class=navbar-header>
      <button type=button class=navbar-toggle data-toggle=collapse data-target="#main-navbar">
        <span class=sr-only>Toggle nav</span>
        <span class=icon-bar></span>
        <span class=icon-bar></span>
        <span class=icon-bar></span>
      </button>
      <a class=navbar-brand href="https://robinm8.github.io">Mark Robinson</a>
    </div>
    <div class="collapse navbar-collapse" id=main-navbar>
      <ul class="nav navbar-nav navbar-right">
        
        <li>
          <a id='home'>Home</a>
        </li>
        
        <li>
          <a id='about'>About Me</a>
        </li>
        
        <li>
          <div class=cntr>
            <div class=cntr-innr>
              <label class=search for=search-query>
                <form action="/search" method="get">
                  <input id=search-query type=text name=q placeholder=Search... />
                </form>
              </label>
            </div>
          </div>
          <li>
          </ul>
        </div>

        
        <div class=avatar-container>
          <div class=avatar-img-border>
            <a href='https://robinm8.github.io'>
              <img width="100px" class=avatar-img src="/img/close_up.png" />
            </a>
          </div>
        </div>
        

        <div class="social-buttons-together hidden">
          <div class="nav navbar-nav">
            
            <li>
              <a href="https://stackoverflow.com/users/5380730/mark" title=StackOverflow>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://github.com/robinm8" title=GitHub>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://twitter.com/robinm80" title=Twitter>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://www.facebook.com/robinm8" title=Facebook>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://linkedin.com/in/robinm8" title=LinkedIn>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="/feed.xml" title=RSS>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="mailto:mark@codecornerapps.com" title=Email me>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            

          </div>
        </div>

        <div class=social-buttons-left>
          <div class="nav navbar-nav">
            
            <li>
              <a href="https://stackoverflow.com/users/5380730/mark" title=StackOverflow>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://github.com/robinm8" title=GitHub>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://twitter.com/robinm80" title=Twitter>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://www.facebook.com/robinm8" title=Facebook>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="https://linkedin.com/in/robinm8" title=LinkedIn>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
          </div>
        </div>

        <div class=social-buttons-right>
          <div class="nav navbar-nav">
            
            <li>
              <a href="/feed.xml" title=RSS>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
            
            <li>
              <a href="mailto:mark@codecornerapps.com" title=Email me>
                <span class="fa-stack fa-lg" style="font-size: 1.5555em">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
          </div>
        </div>
      </div>
    </nav>

    <div class="intro-header"></div>

<div role="main" class="container">
  
<script id=search-results-template type="text/mustache">
  {{#entries}}
    <article>
      <h3>
        {{#date}}<small><time datetime="{{pubdate}}" pubdate>{{displaydate}}</time></small>{{/date}}
        <a href="{{url}}">{{title}}</a>
      </h3>
    </article>
  {{/entries}}
</script>



<header class="header-post">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    
    <section id=search-results style=display:none>
      <div class=index-posts-title>Search results</div>
      <div class=entries></div>
      </br>
    </section>

    
      <div class="post-heading">
        <h1>In-Depth Nginx</h1>
        
        <span class="post-meta">December 5, 2016</span>
	   | 
	    
	        <a href="/tags#yacs" class="post-tag">YACS</a>
	    
	        <a href="/tags#web" class="post-tag">Web</a>
	    
	

      </div>
     </div>
  </div>
</header>

<article>
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <p>I am pleased to announce that YACS will soon run using Nginx with Docker. Docker makes the installation of Nginx easy by simply specifying the Nginx image name in the “docker-compose.yml” file.</p>

<p>The switch from Apache to Nginx induces great performance improvements. This is because Nginx caches static files. In the “nginx.config” file that I made for YACS on Docker, I set Nginx to cache images, css, js, svg, html, xml files for 30 days. Once a visitor navigates to any of those file types, Nginx caches the file so it can efficiently load the file for the next visitor.</p>

<p>Nginx is highly compatible with web applications, like Ruby on Rails projects (i.e. YACS.) This was accomplished by using Puma, a web server for Ruby which is concurrent and lightweight. In the docker-compose.yml file, the container for Puma exposes port 3000 to rest of the containers and does not forward the Puma service on the host machine. Since Nginx is relatively simple to work with, I set up a forward proxy to the container containing Puma, which is called “web,” and forwarded ports 80 and 443 to the host machine’s ports using the “docker-compose.yml” file.</p>

<p>To enforce HTTPS with strict transport security, I configured Nginx to redirect port 80 connections to port 443 with a 301 “Moved Permanently” response. As well, I set Nginx to enable use of the new http/2 protocol for its high transfer speed over the http/1 protocol.</p>

<p>There is another amazing feature of modern web servers which is called “OCSP (SSL) stapling.” SSL stapling verifies that the SSL certificate, from the server, is valid. The brilliance of this feature is that it allows a web server like Nginx to provide information on the validity of its own certificates rather than having the browser send a request to the certificate’s vendor every time the browser needs to check the validity of the server’s certificate. SSL stapling effectively shifts the burden of handling OCSP requests from the certificate vendors to web servers, which in turn helps users connect to YACS faster and more securely than they could if YACS was insecure.</p>

<p>I have overridden the Nginx default weak DHE (Ephemeral Diffie-Hellman) parameters provided by OpenSSL, by generating a 4096-bit DHE parameters file for the server that runs YACS. This ensures highly secure communications between the server and clients.</p>

<p>I tried to make an SSL cipher list that is compatible with many browsers while remaining very secure. The choice to set ChaCha20-Poly1305 was the most favored cipher because the server running YACS does not currently run processors that support the AES-NI instruction set. Since ChaCha-Poly is a new symmetric cipher, it means that ChaCha-Poly will compute faster than AES will on the same machine.</p>

<p>Finally, I made a Content Security Policy to enforce only loading approved asset locations and denying all others. This is to prevent XSS attacks, clickjacking, and other code injection attacks that can result from the execution of malicious third-party content.</p>

<p>To optimize Nginx even further, I enabled “tcp_nopush” and “tcp_nodelay.” These options allow Nginx to send the requested data as soon as it’s available, to save resources. This greatly reduces network overhead and increases the speed at which files are sent.</p>

<p>Lastly, I enabled gzip compression. This significantly reduces the size of transmitted data to client web browsers by compressing the files on the web server.</p>

<p>Overall, Nginx has been a pleasure to work with via Docker and I hope everyone will be able to enjoy the benefits of Nginx soon.</p>

	</div>
  </div>  
</article>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <ul class="pager blog-pager">
      
      
      <script type="text/javascript">
      	window.onload = function(){
      		var blogDomain = "http%3A%2F%2Fblog.codecornerapps.com";
      		var pageTitle = "In-Depth Nginx";
      		var pageTitleDashes = pageTitle.replace(/ /g, '-') + "%2F&amp;";
      		var pageTitleSpaces = pageTitle.replace(/ /g, '%20') + "&amp;";
      		var pageDateShort = "";
      		var pageDateShortSlashes = pageDateShort.replace(/-/g, '%2F') + "%2F";

       		var twitterPartOne = "https://twitter.com/intent/tweet?original_referer=";
       		var twitterPartTwo = "text=";
       		var twitterPartThree = "tw_p=tweetbutton&amp;url=";
       		var twitterPartFour = "&amp;via=robinm8_";
       		var twitterUrl = twitterPartOne + blogDomain + pageDateShortSlashes + pageTitleDashes + twitterPartTwo + pageTitleSpaces + twitterPartThree + window.location.href + twitterPartFour;
       		var twitterLink = document.getElementById("twitter-link");
       		twitterLink.onclick = function() {popUp=window.open(twitterUrl, 'popupwindow', 'scrollbars=yes,width=600,height=400');popUp.focus();return false };

       		var linkedinPartOne = "http://www.linkedin.com/shareArticle?mini=true&url=";
       		var linkedinPartTwo = "&title=";
       		var linkedinPartThree = "&summary=";
       		var linkedinPartFour = "&source=";
       		var linkedinUrl = linkedinPartOne + window.location.href + linkedinPartTwo + pageTitleSpaces + linkedinPartFour + "@robinm8";
       		var linkedInLink = document.getElementById("linkedin-link");
       		linkedInLink.onclick = function() {popUp=window.open(linkedinUrl, 'popupwindow', 'scrollbars=yes,width=600,height=400');popUp.focus();return false };

       		var googlePlusPartOne = "https://plus.google.com/share?url=";
       		var googlePlusUrl = googlePlusPartOne + window.location.href;
       		var googlePlusLink = document.getElementById("googleplus-link");
       		googlePlusLink.onclick = function() {popUp=window.open(googlePlusUrl, 'popupwindow', 'scrollbars=yes,width=600,height=400');popUp.focus();return false };
       	};
      </script>

      <div class="custom-social-buttons">
       	<div class="share-buttons-label">
       		<h3>Share this post</h3>
       	</div>
       	<div class="custom-social-button twitter">
       		<a id="twitter-link" href="#"><i class="fa fa-twitter"></i></a>
       	</div>
       	<div class="custom-social-button linkedin">
       		<a id="linkedin-link" href="#"><i class="fa fa-linkedin"></i></a>
       	</div>
       	<div class="custom-social-button googleplus">
       		<a id="googleplus-link" href="#"><i class="fa fa-google-plus"></i></a>
       	</div>
      </div>
      
    </ul>
  </div>
</div>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <ul class="pager blog-pager">
      
      <li class="previous">
        <a href="/2016-11-30-yacs-on-android-part2" data-toggle="tooltip" data-placement="top" title="YACS Website Advancements">&larr; Previous Post</a>
      </li>
      
      
      <li class="next">
        <a href="/2016-12-08-end-of-semester-thoughts" data-toggle="tooltip" data-placement="top" title="End of Semester Thoughts">Next Post &rarr;</a>
      </li>
      
    </ul>
  </div>
</div>





<div class="row disqus-comments">
  <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <ul class="pager blog-pager">
      <h3>Comments</h3>
    </ul>
    </br>
    <div class="fb-like" data-share="true" data-width="450" data-show-faces="false"></div>
  </div>
  <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <div class="fb-comments" data-href="https://robinm8.github.io/2016-12-05-In-Depth_Nginx" data-width="750" data-include-parent="true"></div>
  </div>
</div>


</div>

    <footer>
  <div class=container>
    <div class=row>
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">©
          Mark Robinson
          &nbsp;&bull;&nbsp;
          2017

          
          &nbsp;&bull;&nbsp;
          <a href="mailto:mark@codecornerapps.com">mark@codecornerapps.com</a>
          
        </p>
        <p class="theme-by text-muted">
          Powered by <a href="http://jekyllrb.com/">Jekyll</a> with the <a href="https://github.com/daattali/beautiful-jekyll">beautiful-jekyll</a> theme
        </p>
      </div>
    </div>
  </div>
</footer>

    


  
    <script async defer="defer">
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = "/css/bootstrap.min.css";
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
      webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);
    </script>
  
    <script async defer="defer">
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = "/css/main.css";
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
      webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);
    </script>
  



  
  <script async type="text/javascript" defer="defer">
      function getScript(url,success){
        var script=document.createElement('script');
        script.src=url;
        
        var head=document.getElementsByTagName('head')[0],
            done=false;
            
        script.onload=script.onreadystatechange = function(){
          if ( !done && (!this.readyState || this.readyState == 'loaded' || this.readyState == 'complete') ) {
            done=true;
            success();
            script.onload = script.onreadystatechange = null;
            head.removeChild(script);
          }
        };
        
        head.appendChild(script);
      }
      
      getScript("/js/search.min.js", function() {
      
          window.fbAsyncInit = function() {
            FB.init({
              appId      : '217893771945954',
              xfbml      : true,
              version    : 'v2.7'
            });
          };

          (function(d, s, id){
             var js, fjs = d.getElementsByTagName(s)[0];
             if (d.getElementById(id)) {return;}
             js = d.createElement(s); js.id = id;
             js.src = "//connect.facebook.net/en_US/sdk.js";
             fjs.parentNode.insertBefore(js, fjs);
           }(document, 'script', 'facebook-jssdk'));
      
      
      
        $('#search-query').lunrSearch({
          indexUrl: '/js/index.json',   // Url for the .json file containing search index data
          results : '#search-results',  // selector for containing search results element
          entries : '.entries',         // selector for search entries containing element (contained within results above)
          template: '#search-results-template',  // selector for Mustache.js template
          emptyMsg  : '<p>Nothing found.</p>'     // shown message if search returns no results
        });
        
        getScript("/js/main.js", function() {
          getScript("/js/bootstrap.min.js", function() {

            
              
                  var cb = function() {
                    var l = document.createElement('link'); l.rel = 'stylesheet';
                    l.href = "//fonts.googleapis.com/css?family=Open+Sans:800";
                    var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
                  };
                  var raf = requestAnimationFrame || mozRequestAnimationFrame ||
                  webkitRequestAnimationFrame || msRequestAnimationFrame;
                  if (raf) raf(cb);
              
            
            
            
              
                  var cb = function() {
                    var l = document.createElement('link'); l.rel = 'stylesheet';
                    l.href = '//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css';
                    var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
                  };
                  var raf = requestAnimationFrame || mozRequestAnimationFrame ||
                  webkitRequestAnimationFrame || msRequestAnimationFrame;
                  if (raf) raf(cb);
                  else window.addEventListener('load', cb);
              
            
          
          });
        });       
      });
  
  </script>


  </body>
</html>
